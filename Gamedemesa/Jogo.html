<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Tracker - Tampinhas</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
        body {
            font-family:system-ui,-apple-system,sans-serif;
            background:linear-gradient(135deg,#0d1117,#161b22);
            color:#e6edf3;
            min-height:100vh;
            touch-action:manipulation;
        }
        #container { max-width:420px; margin:0 auto; padding:16px; }
        h1 { font-size:1.8rem; text-align:center; margin:16px 0; }
        .grid-2 { display:grid; grid-template-columns:1fr 1fr; gap:16px; margin:20px 0; }
        .btn {
            background:rgba(255,255,255,0.06);
            border-radius:16px;
            padding:16px;
            text-align:center;
            cursor:pointer;
            transition:all 0.15s;
            user-select:none;
            border:none;
            color:inherit;
            font-size:1.1rem;
            font-weight:bold;
        }
        .btn:active { background:rgba(255,255,255,0.14); transform:scale(0.97); }
        .square { width:90px; height:90px; margin:0 auto 8px; border:3px solid #444; border-radius:14px; display:flex; align-items:center; justify-content:center; }
        .circle { width:60px; height:60px; border-radius:50%; }
        .cultista{background:#ffffff} .ladino{background:#e53935} .guerreiro{background:#43a047} .teleportador{background:#0288d1}
        .bar { height:26px; background:rgba(255,255,255,0.1); border-radius:13px; overflow:hidden; margin:8px 0 4px; }
        .health-bar.shake { animation:shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%,90%{transform:translate3d(-1px,0,0)} 20%,80%{transform:translate3d(2px,0,0)} 30%,50%,70%{transform:translate3d(-4px,0,0)} 40%,60%{transform:translate3d(4px,0,0)} }
        .fill { height:100%; transition:width 0.4s ease; }
        .damage-buttons { display:flex; gap:12px; margin:16px 0; }
        .damage-btn { flex:1; padding:18px; font-size:1.4rem; font-weight:bold; border-radius:12px; color:white; cursor:pointer; border:none; }
        #dmg-10 { background:#7cb342; } #dmg-20 { background:#f4511e; }
        #fell-off-table { width:100%; background:#b71c1c !important; padding:18px; margin:12px 0; font-size:1.3rem !important; border-radius:12px; }
        button.big { width:100%; padding:16px; margin:8px 0; font-size:1.1rem; font-weight:bold; border:none; border-radius:12px; cursor:pointer; }
        #attack-btn { background:#fb8c00; color:white; }
        #skill-btn { display:none; font-size:1.2rem; }
        .bottom-buttons { display:flex; gap:8px; flex-wrap:wrap; }
        .bottom-buttons button { flex:1; min-width:48%; padding:16px; }
        #turn-display { text-align:center; font-size:1.6rem; font-weight:bold; margin:20px 0; color:#ffeb3b; text-shadow:0 0 10px #ffeb3b55; }
        #game-over-screen {
            position:fixed; inset:0; background:rgba(0,0,0,0.95); display:none; place-items:center; z-index:2000; color:#ff1744; text-align:center; cursor:pointer;
        }
        #game-over-screen h1 { font-size:5rem; margin-bottom:20px; text-shadow:0 0 30px #ff1744aa; }
        #game-over-screen p { font-size:1.6rem; margin-bottom:40px; color:#e0e0e0; }
        #game-over-screen button { background:#424242; color:white; font-size:1.3rem; padding:20px 60px; }
        .modal { position:fixed; inset:0; background:rgba(0,0,0,0.92); display:none; place-items:center; z-index:1000; }
        .modal-content { background:#0f0f0f; padding:32px 24px; border-radius:20px; width:88%; max-width:360px; text-align:center; }
        #initiative-number { font-size:5.5rem; font-weight:bold; color:#ffeb3b; margin:20px 0; }
        #message {
            position:fixed; top:16px; left:50%; transform:translateX(-50%);
            background:rgba(0,0,0,0.88); padding:14px 24px; border-radius:12px; font-size:1.05rem; font-weight:600;
            opacity:0; transition:opacity 0.4s; z-index:999; max-width:92%; text-align:center; pointer-events:none;
        }
        #message.show { opacity:1; }
        #init-text { font-size:1.1rem; opacity:0.8; margin-top:4px; }
    </style>
</head>
<body>

<div id="container">

    <!-- Tela inicial -->
    <div id="start-screen">
        <h1>Tracker Tampinhas</h1>

        <p style="text-align:center; margin:16px 0; opacity:0.9;">Escolha sua classe para começar</p>

        <div class="grid-2 classes-grid">
            <div class="btn class-card" data-class="cultista">
                <div class="square"><div class="circle cultista"></div></div>
                <h2>Cultista</h2>
            </div>
            <div class="btn class-card" data-class="ladino">
                <div class="square"><div class="circle ladino"></div></div>
                <h2>Ladino</h2>
            </div>
            <div class="btn class-card" data-class="guerreiro">
                <div class="square"><div class="circle guerreiro"></div></div>
                <h2>Guerreiro</h2>
            </div>
            <div class="btn class-card" data-class="teleportador">
                <div class="square"><div class="circle teleportador"></div></div>
                <h2>Teleportador</h2>
            </div>
        </div>

        <div style="display:flex; gap:12px; margin-top:24px;">
            <button id="rules-btn" class="big" style="background:#7e57c2; color:white; flex:1;">Regras</button>
            <button id="reset-all-btn" class="big" style="background:#424242; color:white; flex:1;">Resetar Tudo</button>
        </div>
    </div>

    <!-- Tela do jogo -->
    <div id="game-screen" style="display:none;">
        <div id="turn-display">Turno: <span id="turn-num">0</span></div>

        <div style="text-align:center; margin-bottom:16px;">
            <div class="square"><div class="circle" id="class-circle"></div></div>
            <h1 id="class-name">—</h1>
            <div id="init-text">Init: —</div>
        </div>

        <div>
            <strong>Vida</strong>
            <div class="bar health-bar"><div class="fill" id="health-fill" style="background:#66bb6a;"></div></div>
            <div id="health-text" style="text-align:center; font-size:1.3rem; margin-top:4px;">100 / 100</div>
        </div>

        <div>
            <strong>Dano Recebido</strong>
            <div class="damage-buttons">
                <button class="damage-btn" id="dmg-10">10</button>
                <button class="damage-btn" id="dmg-20">20</button>
            </div>
            <button id="fell-off-table" class="damage-btn">Caiu da Mesa (-10)</button>
        </div>

        <div style="margin:20px 0;">
            <strong>Carga de Habilidade</strong>
            <div class="bar"><div class="fill" id="charge-fill" style="background:#42a5f5;"></div></div>
            <div id="charge-text" style="text-align:center; font-size:1.2rem;">0%</div>
        </div>

        <button id="attack-btn" class="big">Ataque Realizado</button>
        <button id="skill-btn" class="big">Usar Habilidade</button>

        <div class="bottom-buttons">
            <button id="reset-player-btn" class="btn" style="background:#e53935;">Resetar</button>
            <button id="back-btn" class="btn" style="background:#616161;">Voltar</button>
        </div>
    </div>
</div>

<!-- Game Over -->
<div id="game-over-screen">
    <div>
        <h1>GAME OVER</h1>
        <p>Sua tampinha caiu... ou foi destruída!</p>
        <button id="back-to-menu">Voltar ao Menu</button>
    </div>
</div>

<!-- Modal Iniciativa -->
<div id="initiative-modal" class="modal">
    <div class="modal-content">
        <h2>Sua Iniciativa</h2>
        <div id="initiative-number">??</div>
        <button id="ok-initiative" style="background:#66bb6a; color:white; padding:18px 80px; font-size:1.4rem; margin-top:16px;">OK</button>
    </div>
</div>

<!-- Modal Regras -->
<div id="rules-modal" class="modal">
    <div class="modal-content" style="text-align:left; max-height:80vh; overflow-y:auto;">
        <h2 style="text-align:center;">Regras do Jogo</h2>
        <ul style="list-style:none; line-height:1.6; margin:20px 0; font-size:1.05rem;">
            <li>• A ordem é decidida pelo número menor para o maior</li>
            <li>• Caiu da mesa perde 10 de vida</li>
            <li>• Use apenas **uma mão** para se movimentar (sem objetos)</li>
            <li>• Dano quando tampinha acerta outra</li>
            <li>• Anuncie ao usar habilidade</li>
        </ul>
        <button id="close-rules" style="background:#e53935; color:white; width:100%; padding:16px; font-size:1.1rem; margin-top:16px;">Fechar</button>
    </div>
</div>

<div id="message"></div>

<script>
const TURN_KEY = 'tampinhas_turn';
const PLAYER_KEY = 'tampinhas_player';

let turn = parseInt(localStorage.getItem(TURN_KEY) || '0');
let player = JSON.parse(localStorage.getItem(PLAYER_KEY) || '{}');

if (!player.class) {
    player = {
        class: null,
        health: 100,
        maxHealth: 100,
        charge: 0,
        doubleDamage: false,
        ignoreNext: false,
        noAttackThisTurn: false,
        initiative: 0
    };
}

const colors = {
    cultista: '#ffffff',
    ladino: '#e53935',
    guerreiro: '#43a047',
    teleportador: '#0288d1'
};

const skillMessages = {
    cultista: "Sacrificar! Perde 10% da vida, próximo ataque causa 2× dano!",
    ladino: "Agora você pode fazer dois movimentos!",
    guerreiro: "Você ignorará o próximo ataque recebido!",
    teleportador: "Teleportar! Pode colocar qualquer jogador em qualquer lugar da mesa (sem ataque neste turno)"
};

const els = {
    startScreen: document.getElementById('start-screen'),
    gameScreen: document.getElementById('game-screen'),
    gameOverScreen: document.getElementById('game-over-screen'),
    initiativeModal: document.getElementById('initiative-modal'),
    initiativeNumber: document.getElementById('initiative-number'),
    rulesModal: document.getElementById('rules-modal'),
    messageDiv: document.getElementById('message'),
    healthBar: document.querySelector('.health-bar'),
    healthFill: document.getElementById('health-fill'),
    healthText: document.getElementById('health-text'),
    classCircle: document.getElementById('class-circle'),
    className: document.getElementById('class-name'),
    initText: document.getElementById('init-text'),
    chargeFill: document.getElementById('charge-fill'),
    chargeText: document.getElementById('charge-text'),
    attackBtn: document.getElementById('attack-btn'),
    skillBtn: document.getElementById('skill-btn'),
    turnNum: document.getElementById('turn-num'),
    goPlayer: document.getElementById('go-player')
};

function saveData() {
    localStorage.setItem(PLAYER_KEY, JSON.stringify(player));
    localStorage.setItem(TURN_KEY, turn.toString());
}

// Seleção de classe
document.querySelectorAll('.class-card').forEach(card => {
    card.addEventListener('click', () => {
        player.class = card.dataset.class;
        const rnd = Math.floor(Math.random() * 100) + 1;
        player.initiative = rnd;
        els.initiativeNumber.textContent = rnd;
        els.initiativeModal.style.display = 'grid';
        saveData();
    });
});

// OK iniciativa → jogo
document.getElementById('ok-initiative').addEventListener('click', () => {
    els.initiativeModal.style.display = 'none';
    els.startScreen.style.display = 'none';
    els.gameScreen.style.display = 'block';
    updateUI();
});

// Regras
document.getElementById('rules-btn').addEventListener('click', () => els.rulesModal.style.display = 'grid');
document.getElementById('close-rules').addEventListener('click', () => els.rulesModal.style.display = 'none');

// Reset tudo
document.getElementById('reset-all-btn').addEventListener('click', () => {
    if (confirm("Resetar tudo e voltar ao início?")) {
        localStorage.clear();
        location.reload();
    }
});

// Dano
document.getElementById('dmg-10').addEventListener('click', () => takeDamage(10, 'Dano normal'));
document.getElementById('dmg-20').addEventListener('click', () => takeDamage(20, 'Dano crítico'));
document.getElementById('fell-off-table').addEventListener('click', () => takeDamage(10, 'CAIU DA MESA!'));

function takeDamage(dmg, reason) {
    if (player.ignoreNext) {
        showMessage("Ataque ignorado!", colors.guerreiro);
        player.ignoreNext = false;
    } else {
        player.health = Math.max(0, player.health - dmg);
        showMessage(`${reason} -${dmg} HP`, '#ff7043');
        triggerShake();
    }
    saveData();
    checkGameOver();
    updateUI();
}

function triggerShake() {
    els.healthBar.classList.remove('shake');
    void els.healthBar.offsetWidth;
    els.healthBar.classList.add('shake');
}

// Ataque
els.attackBtn.addEventListener('click', () => {
    if (player.noAttackThisTurn) {
        showMessage("Não pode atacar após Teleportar!", '#ff7043');
        return;
    }
    const dmg = player.doubleDamage ? 20 : 10;
    player.doubleDamage = false;
    player.charge = Math.min(100, player.charge + 20);
    player.noAttackThisTurn = false;
    turn++;
    els.turnNum.textContent = turn;
    showMessage(`Ataque! Dano causado: ${dmg}`, colors[player.class]);
    saveData();
    updateUI();
});

// Habilidade
els.skillBtn.addEventListener('click', () => {
    if (player.charge < 100) return;
    player.charge = 0;
    const color = colors[player.class];
    const msg = skillMessages[player.class];

    if (player.class === 'cultista') {
        const sac = Math.floor(player.maxHealth * 0.10);
        player.health = Math.max(0, player.health - sac);
        player.doubleDamage = true;
        showMessage(`${msg} (-${sac} HP)`, color);
        triggerShake();
    } else if (player.class === 'ladino') {
        showMessage(msg, color);
    } else if (player.class === 'guerreiro') {
        player.ignoreNext = true;
        showMessage(msg, color);
    } else if (player.class === 'teleportador') {
        player.noAttackThisTurn = true;
        showMessage(msg, color);
    }

    saveData();
    checkGameOver();
    updateUI();
});

// Reset
document.getElementById('reset-player-btn').addEventListener('click', () => {
    player.health = 100;
    player.charge = 0;
    player.doubleDamage = false;
    player.ignoreNext = false;
    player.noAttackThisTurn = false;
    saveData();
    updateUI();
    showMessage('Tudo reiniciado!', '#66bb6a');
});

// Voltar
document.getElementById('back-btn').addEventListener('click', () => {
    els.gameScreen.style.display = 'none';
    els.startScreen.style.display = 'block';
});

// Game Over
function checkGameOver() {
    if (player.health <= 0 && player.class) {
        els.gameScreen.style.display = 'none';
        els.gameOverScreen.style.display = 'grid';
    }
}

els.gameOverScreen.addEventListener('click', returnToStart);
document.getElementById('back-to-menu').addEventListener('click', returnToStart);

function returnToStart() {
    els.gameOverScreen.style.display = 'none';
    els.startScreen.style.display = 'block';
}

function updateUI() {
    if (!player.class) return;

    els.classCircle.className = `circle ${player.class}`;
    els.className.textContent = player.class.charAt(0).toUpperCase() + player.class.slice(1);
    els.initText.textContent = `Init: ${player.initiative}`;

    const hpPerc = player.health / player.maxHealth * 100;
    els.healthFill.style.width = hpPerc + '%';
    els.healthFill.style.background = hpPerc > 60 ? '#66bb6a' : hpPerc > 30 ? '#ffca28' : '#e53935';
    els.healthText.textContent = `${Math.floor(player.health)} / ${player.maxHealth}`;

    els.chargeFill.style.width = player.charge + '%';
    els.chargeText.textContent = `${player.charge}%`;

    const btn = els.skillBtn;
    if (player.charge >= 100) {
        btn.style.display = 'block';
        btn.textContent = player.class === 'cultista' ? 'Sacrificar' : 'Usar Habilidade';
        btn.style.backgroundColor = colors[player.class];
    } else {
        btn.style.display = 'none';
    }

    els.attackBtn.style.opacity = player.noAttackThisTurn ? '0.5' : '1';
    els.attackBtn.style.pointerEvents = player.noAttackThisTurn ? 'none' : 'auto';
}

function showMessage(text, color) {
    els.messageDiv.textContent = text;
    els.messageDiv.style.color = color;
    els.messageDiv.classList.add('show');
    setTimeout(() => els.messageDiv.classList.remove('show'), 8000);
}

// Início
els.startScreen.style.display = 'block';
els.gameScreen.style.display = 'none';
els.turnNum.textContent = turn;

// Se já tinha classe salva, entra direto no jogo
if (player.class) {
    els.startScreen.style.display = 'none';
    els.gameScreen.style.display = 'block';
    updateUI();
}
</script>
</body>
</html>
