<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <title>Tracker - Tampinhas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #0d1117, #161b22);
            color: #e6edf3;
            min-height: 100vh;
            touch-action: manipulation;
        }

        #container {
            max-width: 420px;
            margin: 0 auto;
            padding: 16px;
        }

        h1 { font-size: 1.8rem; text-align: center; margin: 16px 0; }

        .classes-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin: 20px 0;
        }

        .class-card {
            background: rgba(255,255,255,0.06);
            border-radius: 16px;
            padding: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.15s;
            user-select: none;
        }

        .class-card:active {
            background: rgba(255,255,255,0.14);
            transform: scale(0.97);
        }

        .square {
            width: 90px;
            height: 90px;
            margin: 0 auto 8px;
            border: 3px solid #444;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
        }

        .cultista   { background: #ffffff; }
        .ladino     { background: #e53935; }
        .guerreiro  { background: #43a047; }
        .teleportador { background: #0288d1; }

        .bar {
            height: 26px;
            background: rgba(255,255,255,0.1);
            border-radius: 13px;
            overflow: hidden;
            margin: 8px 0 4px;
        }

        .fill {
            height: 100%;
            transition: width 0.4s ease;
        }

        .damage-buttons {
            display: flex;
            gap: 12px;
            margin: 16px 0;
        }

        .damage-btn {
            flex: 1;
            padding: 18px;
            font-size: 1.4rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            color: white;
            cursor: pointer;
        }

        #dmg-10 { background: #7cb342; }
        #dmg-20 { background: #f4511e; }

        button {
            width: 100%;
            padding: 16px;
            margin: 8px 0;
            font-size: 1.1rem;
            font-weight: bold;
            border: none;
            border-radius: 12px;
            cursor: pointer;
        }

        #attack-btn     { background: #fb8c00; color: white; }
        #skill-btn      { display: none; font-size: 1.2rem; }
        .bottom-buttons { display: flex; gap: 12px; }
        .bottom-buttons button { flex: 1; padding: 16px; }

        /* Game Over Screen */
        #game-over-screen {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            display: none;
            place-items: center;
            z-index: 2000;
            color: #ff1744;
            text-align: center;
            cursor: pointer;
        }

        #game-over-screen h1 {
            font-size: 5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 30px #ff1744aa;
        }

        #game-over-screen p {
            font-size: 1.6rem;
            margin-bottom: 40px;
            color: #e0e0e0;
        }

        #game-over-screen button {
            background: #424242;
            color: white;
            font-size: 1.3rem;
            padding: 20px 60px;
        }

        .modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            display: none;
            place-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #0f0f0f;
            padding: 32px 24px;
            border-radius: 20px;
            width: 88%;
            max-width: 360px;
            text-align: center;
        }

        #initiative-number {
            font-size: 5.5rem;
            font-weight: bold;
            color: #ffeb3b;
            margin: 20px 0;
        }

        #message {
            position: fixed;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.88);
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: 600;
            opacity: 0;
            transition: opacity 0.4s;
            z-index: 999;
            max-width: 92%;
            text-align: center;
            pointer-events: none;
        }

        #message.show { opacity: 1; }
    </style>
</head>
<body>

<div id="container">

    <!-- Tela inicial -->
    <div id="start-screen">
        <h1>Escolha sua Classe</h1>

        <div class="classes-grid">
            <div class="class-card" data-class="cultista">
                <div class="square"><div class="circle cultista"></div></div>
                <h2>Cultista</h2>
            </div>

            <div class="class-card" data-class="ladino">
                <div class="square"><div class="circle ladino"></div></div>
                <h2>Ladino</h2>
            </div>

            <div class="class-card" data-class="guerreiro">
                <div class="square"><div class="circle guerreiro"></div></div>
                <h2>Guerreiro</h2>
            </div>

            <div class="class-card" data-class="teleportador">
                <div class="square"><div class="circle teleportador"></div></div>
                <h2>Teleportador</h2>
            </div>
        </div>

        <button id="rules-btn" style="background:#7e57c2; color:white; padding:16px; font-size:1.1rem;">Regras do Jogo</button>
    </div>

    <!-- Tela do jogo -->
    <div id="game-screen" style="display:none;">
        <div style="text-align:center; margin-bottom:16px;">
            <div class="square"><div class="circle" id="class-circle"></div></div>
            <h1 id="class-name">—</h1>
        </div>

        <div>
            <strong>Vida</strong>
            <div class="bar"><div class="fill" id="health-fill" style="background:#66bb6a;"></div></div>
            <div id="health-text" style="text-align:center; font-size:1.3rem; margin-top:4px;">100 / 100</div>
        </div>

        <div>
            <strong>Dano Recebido</strong>
            <div class="damage-buttons">
                <button class="damage-btn" id="dmg-10">10</button>
                <button class="damage-btn" id="dmg-20">20</button>
            </div>
        </div>

        <div style="margin: 20px 0;">
            <strong>Carga de Habilidade</strong>
            <div class="bar"><div class="fill" id="charge-fill" style="background:#42a5f5;"></div></div>
            <div id="charge-text" style="text-align:center; font-size:1.2rem;">0%</div>
        </div>

        <button id="attack-btn">Ataque Realizado</button>
        <button id="skill-btn">Usar Habilidade</button>

        <div class="bottom-buttons">
            <button id="reset-btn" style="background:#e53935;">Reiniciar</button>
            <button id="back-btn" style="background:#616161;">Voltar</button>
        </div>
    </div>
</div>

<!-- Game Over -->
<div id="game-over-screen">
    <div>
        <h1>GAME OVER</h1>
        <p>Sua tampinha caiu... ou foi destruída!</p>
        <button id="back-to-menu">Voltar ao Menu</button>
    </div>
</div>

<!-- Modal Iniciativa -->
<div id="initiative-modal" class="modal">
    <div class="modal-content">
        <h2>Sua Iniciativa</h2>
        <div id="initiative-number">??</div>
        <button id="ok-initiative" style="background:#66bb6a; color:white; padding:18px 80px; font-size:1.4rem; margin-top:16px;">OK</button>
    </div>
</div>

<!-- Modal Regras -->
<div id="rules-modal" class="modal">
    <div class="modal-content" style="text-align:left;">
        <h2 style="text-align:center;">Regras do Jogo</h2>
        <ul style="list-style:none; line-height:1.6; margin:20px 0; font-size:1.05rem;">
            <li>• A ordem é decidida pelo número menor para o maior</li>
            <li>• Caiu da mesa perde 10 de vida</li>
            <li>• O jogador deve usar apenas **uma mão** para se movimentar, seja criativo, mas sem usar objetos, apenas a sua mão</li>
            <li>• O dano é aplicado quando uma tampinha acertar a outra</li>
            <li>• Ao ativar a habilidade o jogador deve anunciar que irá usá-la</li>
        </ul>
        <button id="close-rules" style="background:#e53935; color:white; width:100%; padding:16px; font-size:1.1rem; margin-top:16px;">Fechar</button>
    </div>
</div>

<div id="message"></div>

<script>
// Estado do jogo
const state = {
    class: null,
    health: 100,
    maxHealth: 100,
    charge: 0,
    doubleDamage: false,
    ignoreNext: false,
    noAttackThisTurn: false
};

const colors = {
    cultista: '#ffffff',
    ladino: '#e53935',
    guerreiro: '#43a047',
    teleportador: '#0288d1'
};

const skillMessages = {
    cultista: "Sacrificar! Perde 20% da vida, próximo ataque causa 2× dano!",
    ladino: "Agora você pode fazer dois movimentos!",
    guerreiro: "Você ignorará o próximo ataque recebido!",
    teleportador: "Teleportar! Pode colocar qualquer jogador em qualquer lugar da mesa (sem ataque neste turno)"
};

const elements = {
    startScreen: document.getElementById('start-screen'),
    gameScreen: document.getElementById('game-screen'),
    gameOverScreen: document.getElementById('game-over-screen'),
    initiativeModal: document.getElementById('initiative-modal'),
    initiativeNumber: document.getElementById('initiative-number'),
    rulesModal: document.getElementById('rules-modal'),
    messageDiv: document.getElementById('message')
};

// Seleção de classe
document.querySelectorAll('.class-card').forEach(card => {
    card.addEventListener('click', () => {
        state.class = card.dataset.class;
        const rnd = Math.floor(Math.random() * 100) + 1;
        elements.initiativeNumber.textContent = rnd;
        elements.initiativeModal.style.display = 'grid';
    });
});

// OK iniciativa
document.getElementById('ok-initiative').addEventListener('click', () => {
    elements.initiativeModal.style.display = 'none';
    elements.startScreen.style.display = 'none';
    elements.gameScreen.style.display = 'block';
    resetGame();
    updateUI();
});

// Regras
document.getElementById('rules-btn').addEventListener('click', () => elements.rulesModal.style.display = 'grid');
document.getElementById('close-rules').addEventListener('click', () => elements.rulesModal.style.display = 'none');

// Dano recebido
document.getElementById('dmg-10').addEventListener('click', () => applyDamage(10));
document.getElementById('dmg-20').addEventListener('click', () => applyDamage(20));

function applyDamage(dmg) {
    if (state.ignoreNext) {
        showMessage("Ataque ignorado!", colors.guerreiro);
        state.ignoreNext = false;
    } else {
        state.health = Math.max(0, state.health - dmg);
        showMessage(`-${dmg} de dano`, '#ff7043');
    }
    checkGameOver();
    updateUI();
}

// Ataque realizado
document.getElementById('attack-btn').addEventListener('click', () => {
    if (state.noAttackThisTurn) {
        showMessage("Não pode atacar após usar Teleportar!", '#ff7043');
        return;
    }

    const dmg = state.doubleDamage ? 20 : 10;
    state.doubleDamage = false;
    state.charge = Math.min(100, state.charge + 20);
    state.noAttackThisTurn = false;
    showMessage(`Ataque! Dano causado: ${dmg}`, colors[state.class]);
    updateUI();
});

// Usar habilidade
document.getElementById('skill-btn').addEventListener('click', () => {
    if (state.charge < 100) return;
    state.charge = 0;

    const color = colors[state.class];
    const msg = skillMessages[state.class];

    if (state.class === 'cultista') {
        const sac = Math.floor(state.maxHealth * 0.2);
        state.health = Math.max(0, state.health - sac);
        state.doubleDamage = true;
        showMessage(`${msg} (-${sac} HP)`, color);
    } else if (state.class === 'ladino') {
        showMessage(msg, color);
    } else if (state.class === 'guerreiro') {
        state.ignoreNext = true;
        showMessage(msg, color);
    } else if (state.class === 'teleportador') {
        state.noAttackThisTurn = true;
        showMessage(msg, color);
    }

    checkGameOver();
    updateUI();
});

// Game Over check
function checkGameOver() {
    if (state.health <= 0) {
        elements.gameScreen.style.display = 'none';
        elements.gameOverScreen.style.display = 'grid';
    }
}

// Game Over → voltar ao menu
elements.gameOverScreen.addEventListener('click', returnToStart);
document.getElementById('back-to-menu').addEventListener('click', returnToStart);

function returnToStart() {
    elements.gameOverScreen.style.display = 'none';
    elements.startScreen.style.display = 'block';
    resetGame();
}

// Reiniciar / Voltar
document.getElementById('reset-btn').addEventListener('click', () => {
    resetGame();
    updateUI();
    showMessage('Tudo reiniciado!', '#66bb6a');
});

document.getElementById('back-btn').addEventListener('click', () => {
    elements.gameScreen.style.display = 'none';
    elements.startScreen.style.display = 'block';
});

function resetGame() {
    state.health = 100;
    state.charge = 0;
    state.doubleDamage = false;
    state.ignoreNext = false;
    state.noAttackThisTurn = false;
}

function updateUI() {
    document.getElementById('class-circle').className = `circle ${state.class}`;
    document.getElementById('class-name').textContent = state.class.charAt(0).toUpperCase() + state.class.slice(1);

    const hpPerc = state.health / state.maxHealth * 100;
    const hpFill = document.getElementById('health-fill');
    hpFill.style.width = hpPerc + '%';
    hpFill.style.background = hpPerc > 60 ? '#66bb6a' : hpPerc > 30 ? '#ffca28' : '#e53935';
    document.getElementById('health-text').textContent = `${Math.floor(state.health)} / ${state.maxHealth}`;

    document.getElementById('charge-fill').style.width = state.charge + '%';
    document.getElementById('charge-text').textContent = `${state.charge}%`;

    const btn = document.getElementById('skill-btn');
    if (state.charge >= 100) {
        btn.style.display = 'block';
        btn.textContent = state.class === 'cultista' ? 'Sacrificar' : 'Usar Habilidade';
        btn.style.backgroundColor = colors[state.class];
    } else {
        btn.style.display = 'none';
    }

    document.getElementById('attack-btn').style.opacity = state.noAttackThisTurn ? '0.5' : '1';
    document.getElementById('attack-btn').style.pointerEvents = state.noAttackThisTurn ? 'none' : 'auto';
}

function showMessage(text, color) {
    elements.messageDiv.textContent = text;
    elements.messageDiv.style.color = color;
    elements.messageDiv.classList.add('show');
    setTimeout(() => elements.messageDiv.classList.remove('show'), 8000);
}
</script>
</body>
</html>
